%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Beamer Presentation
% LaTeX Template
% Version 1.0 (10/11/12)
%
% This template has been downloaded from:
% http://www.LaTeXTemplates.com
%
% License:
% CC BY-NC-SA 3.0 (http://creativecommons.org/licenses/by-nc-sa/3.0/)
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%----------------------------------------------------------------------------------------
%	PACKAGES AND THEMES
%----------------------------------------------------------------------------------------

\documentclass[10pt, spanish]{beamer}


\mode<presentation> {

% The Beamer class comes with a number of default slide themes
% which change the colors and layouts of slides. Below this is a list
% of all the themes, uncomment each in turn to see what they look like.

%\usetheme{default}
%\usetheme{AnnArbor}
%\usetheme{Antibes}
%\usetheme{Bergen}
%\usetheme{Berkeley}
%\usetheme{Berlin}
%\usetheme{Boadilla}
%\usetheme{CambridgeUS}
%\usetheme{Copenhagen}
%\usetheme{Darmstadt}
%\usetheme{Dresden}
%\usetheme{Frankfurt}
%\usetheme{Goettingen}
%\usetheme{Hannover}
%\usetheme{Ilmenau}
%\usetheme{JuanLesPins}
%\usetheme{Luebeck}
%\usetheme{Madrid}
%\usetheme{Malmoe}
%\usetheme{Marburg}
%\usetheme{Montpellier}
%\usetheme{PaloAlto}
%\usetheme{Pittsburgh}
\usetheme{Rochester}
%\usetheme{Singapore}
%\usetheme{Szeged}
%\usetheme{Warsaw}

% As well as themes, the Beamer class has a number of color themes
% for any slide theme. Uncomment each of these in turn to see how it
% changes the colors of your current slide theme.

%\usecolortheme{albatross}
%\usecolortheme{beaver}
%\usecolortheme{beetle}
%\usecolortheme{crane}
%\usecolortheme{dolphin}
%\usecolortheme{dove}
%\usecolortheme{fly}
%\usecolortheme{lily}
%\usecolortheme{orchid}
%\usecolortheme{rose}
%\usecolortheme{seagull}
%\usecolortheme{seahorse}
%\usecolortheme{whale}
%\usecolortheme{wolverine}

%\setbeamertemplate{footline} % To remove the footer line in all slides uncomment this line
%\setbeamertemplate{footline}[page number] % To replace the footer line in all slides with a simple slide count uncomment this line

%\setbeamertemplate{navigation symbols}{} % To remove the navigation symbols from the bottom of all slides uncomment this line
}

\usepackage{graphicx} % Allows including images
\usepackage{booktabs} % Allows the use of \toprule, \midrule and \bottomrule in tables
\usepackage[latin9]{inputenc}
\usepackage[spanish]{babel}
\usepackage{svg}
\usepackage{caption}
\captionsetup{font=scriptsize,labelfont=scriptsize}
\setbeamerfont{footnote}{size=\tiny}
\hypersetup{colorlinks=true,linkcolor=blue, linktocpage}
\graphicspath{ {./img/} }
\svgpath{ {./img/} }

%----------------------------------------------------------------------------------------
%	TITLE PAGE
%----------------------------------------------------------------------------------------

\title[Short title]{Certificación y controles de seguridad en Bases de Datos} % The short title appears at the bottom of every slide, the full title is only on the title page

\author{Miguel Expósito Martín} % Your name
\institute[UNICAN] % Your institution as it will appear on the bottom of every slide, may be shorthand to save space
{
Universidad de Cantabria \\ % Your institution for the title page
\medskip
\textit{miguel.exposito@unican.es} % Your email address
}
\date{26/11/2018} % Date, can be changed to a custom date

\addtobeamertemplate{navigation symbols}{}{%
	\usebeamerfont{footline}%
	\usebeamercolor[fg]{footline}%
	\hspace{1em}%
	\insertframenumber/\inserttotalframenumber
}

\begin{document}

\begin{frame}
\titlepage % Print the title page as the first slide
\end{frame}

\begin{frame}
\frametitle{Visión general} % Table of contents slide, comment this block out to remove it
\tableofcontents % Throughout your presentation, if you choose to use \section{} and \subsection{} commands, these will automatically be printed on this slide as an overview of your presentation
\end{frame}

%----------------------------------------------------------------------------------------
%	PRESENTATION SLIDES
%----------------------------------------------------------------------------------------

%------------------------------------------------
\section{Introducción} % Sections can be created in order to organize your presentation into discrete blocks, all sections and subsections are automatically printed in the table of contents as an overview of the talk
%------------------------------------------------

\subsection{Contexto} % A subsection can be created just before a set of slides with a common theme to further break down your presentation into chunks

\begin{frame}
\frametitle{Contexto}
Hoy en día, las bases de datos dan soporte al almacenamiento de todo tipo de información sensible y crítica: cuentas bancarias, balances, datos fiscales, informes médicos, registros sobre empleo, compras con tarjetas de crédito, expedientes académicos...\\~\\

Sin embargo, la seguridad en bases de datos ha sido muchas veces un aspecto al que no se le ha dedicado la atención suficiente. Con la aparición de normas como el Esquema Nacional de Seguridad o la ISO 27001 y la necesidad cada vez mayor de responder ante clientes y usuarios el escenario está cambiando y se está volviendo a poner el foco en la relevancia de estas cuestiones.
\end{frame}

\begin{frame}
	\frametitle{Contexto}
	La mayor parte de las veces, la seguridad en una base de datos consiste en aplicar los principios ya probados y utilizados en el ámbito de las redes de comunicaciones durante décadas: \\~\\
	
\begin{itemize}
	\item Filosofía del mínimo privilegio
	\item Eliminar funcionalidad innecesaria
	\item Ser estricto en la autenticación y el control de acceso
	\item Utilizar encriptación cuando sea necesario
\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{¿Qué base de datos es la más segura?}
	Según datos de la lista de \textit{Common Vulnerabilities and Exposures}:
	\begin{table}
		\begin{tabular}{l l l}
		\toprule
		\textbf{BD} & \textbf{\# Bugs} \\
		\midrule
		Oracle & 430  \\
		MySQL & 259 \\
		Postgresql & 106 \\
		SQL Server & 83  \\
		MongoDB & 13  \\
		\bottomrule
	\end{tabular}
	\caption{Vulnerabilidades registradas en CVE\footnote{\url{http://cve.mitre.org/}} }
\end{table}

\end{frame}

\begin{frame}
	\frametitle{¿Qué base de datos es la más segura?}
Estos datos deben interpretarse \textbf{con cautela}: los inicios de las series históricas varían según el proveedor y no todas las vulnerabilidades existentes tienen por qué estar registradas. Además, no todas las bases de datos tienen el mismo nivel de escrutinio por parte de investigadores o posibles atacantes. Incluso la definición del producto ``base de datos'' puede ser problemática: Oracle y Microsoft suministran otros componentes junto con sus bases de datos.\\~\\
Incluso aunque fuera posible obtener una métrica combinada, sólo se estarían considerando aspectos ``parcheables'' y no las características inherentes de seguridad que proporciona cada base de datos.\\~\\
\begin{block}{Opinión}
Determinados autores\cite{p1} consideran que PostgreSQL es posiblemente la base de datos más enfocada a la seguridad por defecto.
\end{block}	
\end{frame}

\subsection{Normativa aplicable}

\begin{frame}
	\frametitle{Normativa aplicable}
	
	\begin{itemize}
		\item Reglamento General de Protección de Datos (RGPD)
		\item UNE-EN ISO/IEC 27001
		\item En la Administración Pública, Esquema Nacional de Seguridad (ENS)
	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{RGPD}
	
	\begin{block}{¿Qué medidas técnicas aplicar?}
		En  el  RGPD,  los  responsables  y  encargados  establecerán las medidas técnicas y organizativas apropiadas para  garantizar  un  nivel  de  seguridad adecuado en función de los riesgos detectados en el análisis previo.
	\end{block}

	Como referencia:
	
	\begin{itemize}
		\item Las propuestas en el \textit{Esquema Nacional de Seguridad}
		\item Las propuestas en el \href{https://www.boe.es/buscar/act.php?id=BOE-A-2008-979}{\textit{Real Decreto 1720/2007, de 21 de diciembre, por el que se aprueba el Reglamento de desarrollo de la Ley Orgánica 15/1999, de 13 de diciembre, de protección de datos de carácter personal}}
	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{RGPD}
	
	Ejemplos de medidas \textbf{directamente relacionadas} con bases de datos:
	
	\begin{itemize}
		\item Proceso de autorización
		\item Dimensionamiento / gestión de capacidades
		\item Protección de las comunicaciones
		\item Protección de la información:
		\begin{itemize}
			\item Calificación de la información.
			\item Cifrado de la información.
			\item Copias de seguridad.
		\end{itemize}
		\item Protección de servicios y aplicaciones web: inyección de código.
		\item Control de acceso.
		\item Identificación y autenticación.
		\item Auditoría.
		\item Cifrado en las telecomunicaciones.
	\end{itemize}
\end{frame}



\subsection{Dimensiones de la seguridad TI}

\begin{frame}
	\frametitle{Dimensiones de la seguridad TI}
	Hay cuatro aspectos o dimensiones clave en la seguridad de las bases de datos (al igual que en cualquier sistema de información):  \\~\\
	
	\begin{itemize}
		\item Disponibilidad
		\item Autenticidad
		\item Integridad
		\item Confidencialidad
	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{Disponibilidad}
	
	En una base de datos:

	\begin{itemize}
		\item Los datos tienen que estar disponibles el tiempo que sea necesario.
		\item Los datos tienen que estar disponibles tan sólo para los usuarios apropiados.
		\item Debe de ser posible auditar quién ha accedido a qué datos.
	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{Autenticidad}
	
	En una base de datos:
	
	\begin{itemize}
		\item Es necesario asegurar que los datos se modifican por una fuente autorizada.
		\item Es necesario confirmar que los usuarios que acceden al sistema son quienes dicen ser.
		\item Es necesario verificar que cualquier dato de salida está destinado al receptor esperado.
	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{Integridad}
	
	En una base de datos:
	
	\begin{itemize}
		\item Es necesario verificar que cualquier dato de entrada es preciso y verificable.
		\item Debe existir un mecanismo que informe de cualquier cambio en los datos así como su autoría, para garantizar el cumplimiento de las reglas de negocio y la normativa de protección de datos.
		\item Deben existir mecanismos que eviten que los datos sean adulterados o corrompidos.
	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{Confidencialidad}
	
	En una base de datos:
	
	\begin{itemize}
		\item Hay que asegurar que los datos confidenciales solo están a disposición de determinados usuarios.
		\item Es necesario informar de quién ha accedido a qué datos y qué se ha hecho con ellos.
		\item Deben existir mecanismos que impidan la extracción y revelación no autorizada de datos.
		\item Han de asegurarse los datos frente a posibles brechas de seguridad internas o externas.
	\end{itemize}
\end{frame}

\subsection{Principales problemas de seguridad en BBDD} % A subsection can be created just before a set of slides with a common theme to further break down your presentation into chunks

\begin{frame}
	\frametitle{Principales amenazas en la seguridad de TI}
\begin{figure}
	\includegraphics[width=0.7\linewidth]{security_human_factor}
	\caption{Principales vectores de ataque.\footnote{Fuente: \cite{p2}}}
\end{figure}

\end{frame}

\begin{frame}
	\frametitle{Principales amenazas en la seguridad de bases de datos}
	Se pueden identificar las siguientes amenazas comunes en seguridad de bases de datos:  \\~\\
	
	\begin{itemize}
		\item Mal diseño de privilegios de acceso.
		\item Malware.
		\item Poca experiencia y formación en seguridad de bases de datos.
		\item Inyección SQL.
		\item Exploits de bases de datos vulnerables.
	
	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{Mal diseño de privilegios de acceso}
	Muchas veces, por error o debido a políticas de acceso pobres, los privilegios otorgados a un usuario sobre la base de datos exceden los requisitos de su puesto de trabajo. También pueden permanecer sin modificar en el caso de que un trabajador cambie de rol o sea baja en la organización.
	Para evitar este tipo de situaciones, se dan dos recomendaciones:
	\begin{itemize}
		\item Diseñar una política de concesión de privilegios de acceso ajustada a los roles necesarios en la organización.
		\item Realizar auditorías periódicas en las que se comprueben roles y reglas de acceso, llevando a cabo los cambios necesarios para evitar cualquier exposición no deseada.
	\end{itemize}

\begin{alertblock}{Cuidado: aviso a los usuarios }
Si se hacen cambios en los privilegios de acceso, los usuarios lo notarán. Una buena política de comunicación explicando el por qué de los ajustes siempre ayudará a evitar más problemas de la cuenta.
\end{alertblock}
	
\end{frame}

\begin{frame}
	\frametitle{Malware}
	Infecciones comunes a través del correo electrónico, usando técnicas como el \href{https://latam.kaspersky.com/resource-center/definitions/spear-phishing}{\textit{spear phising}}, pueden convertir a los usuarios de bases de datos en conductos de entrada para que los atacantes ganen acceso a redes y datos sensibles. Para incrementar la protección sobre este tipo de ataques, de difícil detección, se recomiendan las siguientes acciones preventivas:
		\begin{itemize}
		\item Campañas de comunicación, concienciación y formación a los usuarios del correo, para que sean capaces de identificar este tipo de amenazas.
		\item Últimos avances en tecnologías de seguridad para el correo electrónico (filtros, inspección de URLs...) 
	\end{itemize}
\begin{alertblock}{Cuidado: el correo electrónico puede llegar a ser inutilizable }
Si los filtros se aplican sin control o los sistemas de seguridad no están correctamente dimensionados en función del número de usuarios de la red, pueden darse problemas irritantes: eliminación de archivos adjuntos, clasificación de remitentes lícitos en SPAM, reescritura de URLs o datos...
\end{alertblock}
	
\end{frame}

\begin{frame}
	\frametitle{Poca experiencia y formación en seguridad de bbdd}
	Muchos de los incidentes de seguridad en TI están relacionados con el \textit{``factor humano''}. Estos incidentes podrían prevenirse siguiendo buenas prácticas en la implementación de controles internos y a través de campañas de formación, comunicación y concienciación de usuarios. \\~\\
	Las tareas que ayudan a mejorar la seguridad de TI están muy relacionadas con la calidad; el personal interno debe estar al día y adecuadamente formado en tecnologías de bases de datos y seguridad. Los órganos directivos de las organizaciones deben comprender la importancia de dedicar recursos a este tipo de tareas, no siendo aceptable un argumento de reducción de costes para no hacerlo.
	\begin{block}{Recordatorio }
\textit{	La calidad es gratis }- Crosby
	\end{block}
\end{frame}

\begin{frame}
	\frametitle{Inyección SQL}
Cualquier componente que cree y ejecute consultas SQL dinámicamente está sujeto, en teoría, a ataques de inyección SQL. Este tipo de ataque permite a un atacante inyectar código para ejecutar comandos remotos que puedan leer o modificar una base de datos, o ser utilizados para escalar en privilegios. Es uno de los ataques a bases de datos más comunes y con el que están relacionadas algunas de las vulnerabilidades más antiguas de distintos SGBD.
	\begin{alertblock}{Cuidado: causas más comunes }
		\begin{itemize}
		\item Validación de entrada de usuario insuficiente en aplicaciones web.
		\item Construcción incorrecta de sentencias SQL en aplicaciones web.
	\end{itemize}
	\end{alertblock}
\end{frame}

\begin{frame}
	\frametitle{Inyección SQL}
	\begin{figure}
		\includegraphics[width=0.7\linewidth]{exploits_of_a_mom}
		\caption{Ejemplo de inyección SQL.\footnote{Fuente: \href{xkcd}{https://xkcd.com/327/}}}
	\end{figure}
\end{frame}

\begin{frame}[fragile]
	\frametitle{Inyección SQL: ejemplo trivial 1/2}
\begin{exampleblock}{Formulario web}
	\begin{verbatim}
		<form action="/cgi-bin/login" method=post>
	Username: <input type=text name=username> 
	Password: <input type=password name=password> 
	<input type=submit value=Login>
	\end{verbatim}
\end{exampleblock}
\begin{exampleblock}{Enviado en la request}
	\begin{verbatim}
username=submittedUser&password=submittedPassword
	\end{verbatim}
	
\end{exampleblock}
\end{frame}

\begin{frame}[fragile]
	\frametitle{Inyección SQL: ejemplo trivial 2/2}
	\begin{exampleblock}{Posible SQL en la aplicación}
		\begin{verbatim}
		select * from Users where (username = 'submittedUser'
		and password = 'submittedPassword');
		\end{verbatim}
	\end{exampleblock}
	\begin{exampleblock}{Envío del atacante}
	\begin{verbatim}
	username=admin%27%29+--+&password=+
	\end{verbatim}
\end{exampleblock}
\begin{exampleblock}{Consulta resultante}
	\begin{verbatim}
	select * from Users where (username = 'admin') -- 
	and password = ' ');
	\end{verbatim}
\end{exampleblock}
\end{frame}
\begin{frame}
	\frametitle{Exploits en bases de datos vulnerables}
	La mayor parte de fallos explotables de seguridad en bases de datos pueden clasificarse en las siguientes categorías:  \\~\\
	
	\begin{itemize}
		\item Fallos de autenticación en protocolos de red.
		\item Fallos en los propios protocolos de autenticación.
		\item Ejecución arbitraria de código en elementos SQL.
		\item Escalado de privilegios locales.
	
	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{Exploits: fallos de autenticación en protocolos de red}
	Uno de los problemas más famosos en esta categoría es el gusano \textit{``Slammer''}, para SQL Server. El servicio de resolución de SQL Server opera en UDP 1434, exponiendo una serie de funciones; dos de ellas eran vulnerables a ataques de buffer overflow. No era necesaria autenticación para explotar estas vulnerabilidades. \\~\\
	Las mejores formas de protegerse de este tipo de ataques son:
	\begin{itemize}
			\item Parchear los SGBD al día.
			\item Asegurarse de que sólo pueden conectarse a los SGBD hosts de confianza.
			\item Implementar algún tipo de IPS/IDS.
	\end{itemize}
\begin{block}{Fallos autenticados}
	Hay bastante menos bugs en esta categoría. La mejor protección contra fallos autenticados en protocolos de red es disponer de una política de contraseñas robusta.
\end{block}
\end{frame}
\begin{frame}
	\frametitle{Exploits: fallos en los protocolos de autenticación}
Históricamente, muchos SGBD utilizaban protocolos de autenticación en texto plano (o con algún tipo de encriptación débil). Por ejemplo, la base matemática del algoritmo de autenticación de \textit{MySQL $<$  4.1} fue \href{https://dev.mysql.com/doc/internals/en/old-password-authentication.html}{puesta en cuestión} por la capacidad de un atacante de determinar el \textit{hash} de una contraseña simplemente observando varias autenticaciones.\\~\\
Como medidas para evitar este tipo de ataques, se tienen las siguientes:
	\begin{itemize}
	\item Parchear los SGBD al día.
	\item Deshabilitar cualquier posible sistema de autenticación en texto plano.
\end{itemize}
\end{frame}
\begin{frame}
	\frametitle{Exploits: ejecución arbitraria de código en elementos SQL}
Son ataques de tipo \textit{buffer overflow} aplicados a elementos de la gramática de SQL que no están sujetos a los controles de acceso tradicionales (GRANT/REVOKE). Este tipo de bugs suelen ser explotados a través de problemas de inyección SQL.
\begin{exampleblock}{Ejecución arbitraria en Oracle}
Oracle presentó un bug que permitía a un atacante ejecutar código arbitrario a través de las funciones NYMTOYMINTERVAL, NUMTODSINTERVAL y FROM\_TZ o el parámetro de sesión TIME\_ZONE.
\end{exampleblock}
La mejor defensa contra este tipo de ataques es parchear los SGBD al día.
\end{frame}
\begin{frame}
	\frametitle{Exploits: Escalado de privilegios locales.}
Esta categoría se compone de bugs que permiten algún tipo de escalado de privilegios a nivel de sistema operativo.
	\begin{exampleblock}{Escalado de privilegios locales}
		\begin{itemize}
		\item Oracle \textit{``extproc''}.
		\item Procedimientos almacenados extendidos de SQL Server y Sybase.
	\end{itemize}
	\end{exampleblock}
	La mejor defensa contra este tipo de ataques es \textbf{ejecutar la base de datos como un usuario con pocos privilegios}, o en una parte segregada del sistema de archivos en la cual solo la base de datos pueda realizar operaciones de lectura/escritura.
\end{frame}
%------------------------------------------------
\begin{frame}
	\frametitle{Resumen}
		\begin{itemize}
		\item Si no se detectan más vulnerabilidades, es porque no se buscan.
		\item La normativa vigente obliga a aplicar medidas de seguridad también a las BBDD.
		\item La inyección SQL es el ataque ``estrella''.
		\item No existe una base de datos ``más segura''.
		\item La mejor prevención: mantener los sistemas actualizados y parcheados.
		
	\end{itemize}
\end{frame}
%------------------------------------------------

\begin{frame}
\frametitle{Referencias}
\footnotesize{
\begin{thebibliography}{99} % Beamer does not support BibTeX so references must be inserted manually as below
\bibitem[Litchfield, 2005]{p1} David Litchfield (2005)
\newblock The Database Hacker's Handbook: Defending Database Servers

\bibitem[Kaspersky, 2017]{p2} Kaspersky Lab (2017)
\newblock IT Security Risks Survey 2017
\end{thebibliography}
}
\end{frame}

%------------------------------------------------


%----------------------------------------------------------------------------------------

\end{document}