%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Beamer Presentation
% LaTeX Template
% Version 1.0 (10/11/12)
%
% This template has been downloaded from:
% http://www.LaTeXTemplates.com
%
% License:
% CC BY-NC-SA 3.0 (http://creativecommons.org/licenses/by-nc-sa/3.0/)
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%----------------------------------------------------------------------------------------
%	PACKAGES AND THEMES
%----------------------------------------------------------------------------------------

\documentclass[10pt, spanish]{beamer}


\mode<presentation> {

% The Beamer class comes with a number of default slide themes
% which change the colors and layouts of slides. Below this is a list
% of all the themes, uncomment each in turn to see what they look like.

%\usetheme{default}
%\usetheme{AnnArbor}
%\usetheme{Antibes}
%\usetheme{Bergen}
%\usetheme{Berkeley}
%\usetheme{Berlin}
%\usetheme{Boadilla}
%\usetheme{CambridgeUS}
%\usetheme{Copenhagen}
%\usetheme{Darmstadt}
%\usetheme{Dresden}
%\usetheme{Frankfurt}
%\usetheme{Goettingen}
%\usetheme{Hannover}
%\usetheme{Ilmenau}
%\usetheme{JuanLesPins}
%\usetheme{Luebeck}
%\usetheme{Madrid}
%\usetheme{Malmoe}
%\usetheme{Marburg}
%\usetheme{Montpellier}
%\usetheme{PaloAlto}
%\usetheme{Pittsburgh}
\usetheme{Rochester}
%\usetheme{Singapore}
%\usetheme{Szeged}
%\usetheme{Warsaw}

% As well as themes, the Beamer class has a number of color themes
% for any slide theme. Uncomment each of these in turn to see how it
% changes the colors of your current slide theme.

%\usecolortheme{albatross}
%\usecolortheme{beaver}
%\usecolortheme{beetle}
%\usecolortheme{crane}
%\usecolortheme{dolphin}
%\usecolortheme{dove}
%\usecolortheme{fly}
%\usecolortheme{lily}
%\usecolortheme{orchid}
%\usecolortheme{rose}
%\usecolortheme{seagull}
%\usecolortheme{seahorse}
%\usecolortheme{whale}
%\usecolortheme{wolverine}

%\setbeamertemplate{footline} % To remove the footer line in all slides uncomment this line
%\setbeamertemplate{footline}[page number] % To replace the footer line in all slides with a simple slide count uncomment this line

%\setbeamertemplate{navigation symbols}{} % To remove the navigation symbols from the bottom of all slides uncomment this line
}


\AtBeginSection[]{
	\begin{frame}
		\vfill
		\centering
	
			\usebeamerfont{title}\insertsectionhead\par%
	
		\vfill
	\end{frame}
}

\AtBeginSubsection[]{
	\begin{frame}
		\vfill
		\centering
		
			\usebeamerfont{title}\insertsubsectionhead\par%
	
		\vfill
	\end{frame}
}

\usepackage{graphicx} % Allows including images
\usepackage{booktabs} % Allows the use of \toprule, \midrule and \bottomrule in tables
\usepackage[latin9]{inputenc}
\usepackage[spanish]{babel}
\usepackage{svg}
\usepackage{caption}
\usepackage{minted}
\captionsetup{font=scriptsize,labelfont=scriptsize}
\setbeamerfont{footnote}{size=\tiny}
\hypersetup{colorlinks=true,linkcolor=blue, linktocpage}
\graphicspath{ {./img/} }
\svgpath{ {./img/} }

%----------------------------------------------------------------------------------------
%	TITLE PAGE
%----------------------------------------------------------------------------------------

\title[Short title]{Certificación y controles de seguridad en Bases de Datos: Introducción} % The short title appears at the bottom of every slide, the full title is only on the title page

\author{Miguel Expósito Martín} % Your name
\institute[UNICAN] % Your institution as it will appear on the bottom of every slide, may be shorthand to save space
{
Universidad de Cantabria \\ % Your institution for the title page
\medskip
\textit{miguel.exposito@unican.es} % Your email address
}
\date{26/11/2018} % Date, can be changed to a custom date

\addtobeamertemplate{navigation symbols}{}{%
	\usebeamerfont{footline}%
	\usebeamercolor[fg]{footline}%
	\hspace{1em}%
	\insertframenumber/\inserttotalframenumber
}

\begin{document}

\begin{frame}
\titlepage % Print the title page as the first slide
\end{frame}

\begin{frame}
\frametitle{Visión general} % Table of contents slide, comment this block out to remove it
\tableofcontents % Throughout your presentation, if you choose to use \section{} and \subsection{} commands, these will automatically be printed on this slide as an overview of your presentation
\end{frame}

%----------------------------------------------------------------------------------------
%	PRESENTATION SLIDES
%----------------------------------------------------------------------------------------

%------------------------------------------------
\section{Introducción} % Sections can be created in order to organize your presentation into discrete blocks, all sections and subsections are automatically printed in the table of contents as an overview of the talk
%------------------------------------------------

\subsection{Contexto} % A subsection can be created just before a set of slides with a common theme to further break down your presentation into chunks

\begin{frame}
\frametitle{Contexto}
Hoy en día, las bases de datos dan soporte al almacenamiento de todo tipo de información sensible y crítica: cuentas bancarias, balances, datos fiscales, informes médicos, registros sobre empleo, compras con tarjetas de crédito, expedientes académicos...\\~\\

Sin embargo, la seguridad en bases de datos ha sido muchas veces un aspecto al que no se le ha dedicado la atención suficiente. Con la aparición de normas como el Esquema Nacional de Seguridad o la ISO 27001 y la necesidad cada vez mayor de responder ante clientes y usuarios el escenario está cambiando y se está volviendo a poner el foco en la relevancia de estas cuestiones.
\end{frame}

\begin{frame}
	\frametitle{Contexto}
	La mayor parte de las veces, la seguridad en una base de datos consiste en aplicar los principios ya probados y utilizados en el ámbito de las redes de comunicaciones durante décadas: \\~\\
	
\begin{itemize}
	\item Filosofía del mínimo privilegio.
	\item Eliminar funcionalidad innecesaria.
	\item Ser estricto en la autenticación y el control de acceso.
	\item Utilizar encriptación cuando sea necesario.
\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{¿Qué base de datos es la más segura?}
	Según datos de la lista de \textit{Common Vulnerabilities and Exposures}:
	\begin{table}
		\begin{tabular}{l l l}
		\toprule
		\textbf{BD} & \textbf{\# Bugs} \\
		\midrule
		Oracle & 430  \\
		MySQL & 259 \\
		Postgresql & 106 \\
		SQL Server & 83  \\
		MongoDB & 13  \\
		\bottomrule
	\end{tabular}
	\caption{Vulnerabilidades registradas en CVE\footnote{\url{http://cve.mitre.org/}} }
\end{table}

\end{frame}

\begin{frame}
	\frametitle{¿Qué base de datos es la más segura?}
Estos datos deben interpretarse \textbf{con cautela}: los inicios de las series históricas varían según el proveedor y no todas las vulnerabilidades existentes tienen por qué estar registradas. Además, no todas las bases de datos tienen el mismo nivel de escrutinio por parte de investigadores o posibles atacantes. Incluso la definición del producto ``base de datos'' puede ser problemática: Oracle y Microsoft suministran otros componentes junto con sus bases de datos.\\~\\
Incluso aunque fuera posible obtener una métrica combinada, sólo se estarían considerando aspectos ``parcheables'' y no las características inherentes de seguridad que proporciona cada base de datos.\\~\\
\begin{block}{Opinión}
Determinados autores\cite{p1} consideran que PostgreSQL es posiblemente la base de datos más enfocada a la seguridad por defecto.
\end{block}	
\end{frame}

\subsection{Normativa aplicable}

\begin{frame}
	\frametitle{Normativa aplicable}
	
	\begin{itemize}
		\item \href{https://www.boe.es/doue/2016/119/L00001-00088.pdf}{Reglamento General de Protección de Datos (RGPD)}
		\item \href{http://www.iso27000.es/}{UNE-EN ISO/IEC 27001}
		\item \href{https://www.ccn-cert.cni.es/ens.html}{En la Administración Pública, Esquema Nacional de Seguridad (ENS)}
	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{RGPD}
El Reglamento General de Protección de Datos (RGPD), de \textbf{obligado cumplimiento tanto en el ámbito público como en el privado desde el 25 de mayo de 2018} (siempre y cuando se recopilen y hagan tratamientos de datos de personas físicas), refuerza y prevalece sobre ciertos aspectos de la LOPD y el RD que la desarrolla. Incorpora novedades que lo hacen más restrictivo que la antigua normativa, tanto en materia de obligaciones como en sanciones.\\~\\

\href{https://www.wolterskluwer.es/novedades-legales/rgpd/}{Novedades por Wolters Kluwer}

\href{https://www.youtube.com/watch?v=JA2Z_ZHp06g}{Tres ideas sobre sus implicaciones, por Borja Adsuara}

\href{https://www.aepd.es/media/guias/guia-rgpd-para-responsables-de-tratamiento.pdf}{Guía para responsables de tratamiento (AEPD)}

\href{https://www.boe.es/doue/2016/119/L00001-00088.pdf}{Texto original en el BOE}
\end{frame}
\begin{frame}
	\frametitle{RGPD: guía práctica de adaptación en la empresa privada}
	Hoja de ruta para adaptación al RGPD:
		\begin{itemize}
		\item Designar un DPD
		\item Elaborar el registro de actividades de tratamiento
		\item Realizar un análisis de riesgos
		\item Revisar medidas de seguridad a la luz del AR
		\item Establecer mecanismos y procedimientos de notificación de quiebras de seguridad
		\item A partir del AR, realizar, en su caso, una evaluación de impacto en la protección de datos
	
		\end{itemize}

\end{frame}
\begin{frame}
	\frametitle{RGPD: guía práctica de adaptación en la empresa privada}
	Acciones simultáneas a los pasos anteriores:
	\begin{itemize}
		\item Adecuar formularios (derecho de información)
		\item Adaptar mecanismos y procedimientos para el ejercicio de derechos
		\item Adaptar los contratos y valorar si los encargados ofrecen garantías
		\item Elaborar o adaptar la política de privacidad
	\end{itemize}
	
\end{frame}
\begin{frame}
	\frametitle{RGPD: medidas a aplicar}
	
	\begin{block}{¿Qué medidas técnicas aplicar?}
		En  el  RGPD,  los  responsables  y  encargados  establecerán las medidas técnicas y organizativas apropiadas para  garantizar  un  nivel  de  seguridad adecuado en función de los riesgos detectados en el análisis previo.
	\end{block}

	Como referencia:
	
	\begin{itemize}
		\item Las propuestas en el \textit{Esquema Nacional de Seguridad}
		\item Las propuestas en el \href{https://www.boe.es/buscar/act.php?id=BOE-A-2008-979}{\textit{Real Decreto 1720/2007, de 21 de diciembre, por el que se aprueba el Reglamento de desarrollo de la Ley Orgánica 15/1999, de 13 de diciembre, de protección de datos de carácter personal}}
	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{RGPD: medidas a aplicar}
	
	Ejemplos de medidas\footnote{Fuente: \href{https://www.ccn-cert.cni.es/publico/ens/ens/index.html\#!1071}{ENS}} \textbf{directamente relacionadas} con bases de datos:
	
	\begin{itemize}
		\item Proceso de autorización
		\item Dimensionamiento / gestión de capacidades
		\item Protección de las comunicaciones
		\item Protección de la información:
		\begin{itemize}
			\item Calificación de la información.
			\item Cifrado de la información.
			\item Copias de seguridad.
		\end{itemize}
		\item Protección de servicios y aplicaciones web: inyección de código.
		\item Control de acceso.
		\item Identificación y autenticación.
		\item Auditoría.
		\item Cifrado en las telecomunicaciones.
	\end{itemize}
\end{frame}



\subsection{Dimensiones de la seguridad TI}

\begin{frame}
	\frametitle{Dimensiones de la seguridad TI}
	Hay tres dimensiones clave en la seguridad de cualquier sistema de información, y por lo tanto, de un Sistema de Gestión de Bases de Datos (SGBD):
	\begin{columns}[t] % The "c" option specifies centered vertical alignment while the "t" option is used for top vertical alignment
		\column{.45\textwidth} % Left column and width
	\begin{itemize}
		\item Disponibilidad
		\item Integridad
		\item Confidencialidad
	\end{itemize} 
\hrulefill

	A estas dimensiones básicas se les suelen añadir otras dos:
	\begin{itemize}
		\item Autenticidad
		\item Trazabilidad
	\end{itemize}
	
	\column{.5\textwidth} % Right column and width
\begin{figure}
	\includegraphics[width=0.9\linewidth]{cia_triangle}
	\caption{Triángulo CIA. \href{https://en.wikipedia.org/wiki/Information_security}{Wikipedia.}}
\end{figure}

	
\end{columns}
\end{frame}

\begin{frame}
	\frametitle{Disponibilidad}

	\begin{itemize}
		\item Los datos tienen que estar disponibles el tiempo que sea necesario.
		\item Los datos tienen que estar disponibles tan sólo para los usuarios apropiados.
		\item Debe de ser posible auditar quién ha accedido a qué datos.
	\end{itemize}
\begin{exampleblock}{Ejemplos de no disponibilidad}
	\begin{itemize}
	 \item Imposibilidad de acceder al correo electrónico por un error de configuración.
	 \item Caída de un sistema debido a un DoS.
	\end{itemize}
\end{exampleblock}
\end{frame}

\begin{frame}
	\frametitle{Integridad}
	
	\begin{itemize}
		\item Es necesario verificar que cualquier dato de entrada es preciso y verificable, correcto y libre de modificaciones y/o errores.
		\item Debe existir un mecanismo que informe de cualquier cambio en los datos así como su autoría, para garantizar el cumplimiento de las reglas de negocio y la normativa de protección de datos.
		\item Deben existir mecanismos que eviten que los datos sean adulterados o corrompidos.
	\end{itemize}
\begin{exampleblock}{Ejemplos de ataques contra la integridad}
	\begin{itemize}
		\item Alteración malintencionada de los ficheros de un sistema de información explotando una vulnerabilidad.
		\item Modificación de un informe de ventas por un empleado malintencionado o por un error humano.
	\end{itemize}
\end{exampleblock}
\end{frame}

\begin{frame}
	\frametitle{Confidencialidad}
	
	\begin{itemize}
		\item Hay que asegurar que los datos confidenciales solo están a disposición de determinados usuarios autorizados.
		\item Es necesario informar de quién ha accedido a qué datos y qué se ha hecho con ellos.
		\item Deben existir mecanismos que impidan la extracción y revelación no autorizada de datos.
		\item Han de asegurarse los datos frente a posibles brechas de seguridad internas o externas.
	\end{itemize}
\begin{exampleblock}{Ejemplos de falta de confidencialidad}
	\begin{itemize}
		\item Robo de información por parte de un atacante a través de Internet.
		\item Divulgación no autorizada a través de redes.
		\item Acceso por parte de un empleado a información crítica de una Organización a la que no debería tener acceso.
	\end{itemize}
\end{exampleblock}
\end{frame}

\begin{frame}
	\frametitle{Autenticidad}
	
	\begin{itemize}
		\item Es necesario asegurar que los datos se modifican por una fuente autorizada.
		\item Es necesario confirmar que los usuarios que acceden al sistema son quienes dicen ser.
		\item Es necesario verificar que cualquier dato de salida está destinado al receptor esperado.
	\end{itemize}
\begin{exampleblock}{Ejemplos de falta de autenticidad}
	\begin{itemize}
		\item Firma de un documento por otra persona haciéndose pasar por el firmante.
		\item Uso de un usuario y una contraseña de un compañero de trabajo.
	\end{itemize}
\end{exampleblock}
\end{frame}

\begin{frame}
	\frametitle{Ejercicio 1.1 (1/2)}
	El CCN ofrece \href{https://www.ccn-cert.cni.es/series-ccn-stic/800-guia-esquema-nacional-de-seguridad/682-ccn-stic-803-valoracion-de-sistemas-en-el-ens-1/file.html}{una guía} para valorar sistemas de información y categorizarlas según el ENS.	La guía presenta tablas-resumen que ayudan en la categorización; dichas tablas se estructuran de la siguiente forma:
	\begin{itemize}
		\item Criterios comunes a todas las dimensiones de tipos de información y servicios
		\begin{itemize}
			\item Disposición legal
			\item Perjuicio directo al ciudadano
			\item Incumplimiento de norma
			\item Pérdidas económicas
			\item Reputación
			\item Protestas
			\item Delitos
		\end{itemize}
		\item Criterios para tipos de información con datos personales en función del tipo.
		\item Criterios para tipos de información con datos personales en función del tratamiento.
		\item Criterios para la disponibilidad de servicios.
	\end{itemize}
\end{frame}
\begin{frame}
	\frametitle{Ejercicio 1.1 (2/2)}
	En base a esta guía, categorice, \textbf{justificadamente}, las siguientes bases de datos, entendidas en su definición más genérica:
			\begin{enumerate}
			\item Sistema de Información Contable de una Comunidad Autónoma
			\item Sistema de gestión de multas de la DGT
			\item Banco de datos del Instituto Nacional de Estadística
			\item BD documental de informes de auditoría de control financiero
			\item Historial médico de pacientes del SCS
			\item Sede electrónica del punto de acceso general de la AGE
			\item Portal de datos abiertos del Ayuntamiento de Santander
		\end{enumerate}
	\begin{alertblock}{Atención}
		Basta con que una de las dimensiones se categorice como nivel alto o medio para que todo el sistema de información sea categorizado de la misma forma. Intente encontrar un criterio por el cual el sistema se categorice como alto o medio.
	\end{alertblock}
\end{frame}

\subsection{Principales problemas de seguridad en BBDD} % A subsection can be created just before a set of slides with a common theme to further break down your presentation into chunks

\begin{frame}
	\frametitle{Principales amenazas en la seguridad de TI}
\begin{figure}
	\includegraphics[width=0.7\linewidth]{security_human_factor}
	\caption{Principales vectores de ataque.\footnote{Fuente: \cite{p2}}}
\end{figure}

\end{frame}

\begin{frame}
	\frametitle{Principales amenazas en la seguridad de bases de datos}
	Es posible identificar las siguientes amenazas comunes en seguridad de bases de datos:
	
	\begin{itemize}
		\item Mal diseño de privilegios de acceso.
		\item Malware.
		\item Poca experiencia y formación en seguridad de bases de datos.
		\item Inyección SQL.
		\item Exploits de bases de datos vulnerables.
	
	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{Mal diseño de privilegios de acceso}
	Muchas veces, por error o debido a políticas de acceso pobres, los privilegios otorgados a un usuario sobre la base de datos exceden los requisitos de su puesto de trabajo. También pueden permanecer sin modificar en el caso de que un trabajador cambie de rol o sea baja en la organización.
	Para evitar este tipo de situaciones, se dan dos recomendaciones:
	\begin{itemize}
		\item Diseñar una política de concesión de privilegios de acceso ajustada a los roles necesarios en la organización.
		\item Realizar \textbf{auditorías periódicas} en las que se comprueben roles y reglas de acceso, llevando a cabo los cambios necesarios para evitar cualquier exposición no deseada.
	\end{itemize}

\begin{alertblock}{Atención: aviso a los usuarios }
Si se hacen cambios en los privilegios de acceso, los usuarios lo notarán. Una buena política de comunicación explicando el por qué de los ajustes siempre ayudará a evitar más problemas de la cuenta.
\end{alertblock}
	
\end{frame}

\begin{frame}
	\frametitle{Malware}
	Infecciones comunes a través del correo electrónico, usando técnicas como el \href{https://latam.kaspersky.com/resource-center/definitions/spear-phishing}{\textit{spear phising}}, pueden convertir a los usuarios de bases de datos en conductos de entrada para que los atacantes ganen acceso a redes y datos sensibles. Para incrementar la protección sobre este tipo de ataques, de difícil detección, se recomiendan las siguientes acciones preventivas:
		\begin{itemize}
		\item Campañas de \textbf{comunicación, concienciación y formación} a los usuarios del correo, para que sean capaces de identificar este tipo de amenazas.
		\item Últimos avances en tecnologías de seguridad para el correo electrónico (filtros, inspección de URLs...) 
	\end{itemize}
\begin{alertblock}{Atención: el correo electrónico puede llegar a ser inutilizable }
Si los filtros se aplican sin control o los sistemas de seguridad no están correctamente dimensionados en función del número de usuarios de la red, pueden darse problemas irritantes: eliminación de archivos adjuntos, clasificación de remitentes lícitos en SPAM, reescritura de URLs o datos...
\end{alertblock}
	
\end{frame}

\begin{frame}
	\frametitle{Poca experiencia y formación en seguridad de bbdd}
	Muchos de los incidentes de seguridad en TI están relacionados con el \textit{``factor humano''}. Estos incidentes podrían prevenirse siguiendo buenas prácticas en la implementación de controles internos y a través de campañas de formación, comunicación y concienciación de usuarios. \\~\\
	Las tareas que ayudan a mejorar la seguridad de TI están muy relacionadas con la calidad; el personal interno debe estar al día y adecuadamente formado en tecnologías de bases de datos y seguridad. Los órganos directivos de las organizaciones deben comprender la \textbf{importancia de dedicar recursos a este tipo de tareas}, no siendo aceptable un argumento de reducción de costes para no hacerlo.
	\begin{block}{Recordatorio }
\textit{	La calidad es gratis }- Crosby
	\end{block}
\end{frame}

\begin{frame}
	\frametitle{Inyección SQL}
Cualquier componente que cree y ejecute consultas SQL dinámicamente está sujeto, en teoría, a ataques de inyección SQL. Este tipo de ataque permite a un atacante inyectar código para ejecutar comandos remotos que puedan leer o modificar una base de datos, o ser utilizados para escalar en privilegios. Es uno de los ataques a bases de datos más comunes y con el que están relacionadas algunas de las vulnerabilidades más antiguas de distintos BD.
	\begin{alertblock}{Atención: causas más comunes }
		\begin{itemize}
		\item Validación de entrada de usuario insuficiente en aplicaciones web.
		\item Construcción incorrecta de sentencias SQL en aplicaciones web.
	\end{itemize}
	\end{alertblock}
\end{frame}

\begin{frame}
	\frametitle{Inyección SQL}
	\begin{figure}
		\includegraphics[width=1.0\linewidth]{exploits_of_a_mom}
		\caption{Little Bobby Tables.\footnote{Fuente: \href{xkcd}{https://xkcd.com/327/}}}
	\end{figure}
\end{frame}

\begin{frame}[fragile]
	\frametitle{Inyección SQL: ejemplo trivial 1/2}
\begin{exampleblock}{Formulario web}
	\begin{verbatim}
		<form action="/cgi-bin/login" method=post>
	Username: <input type=text name=username> 
	Password: <input type=password name=password> 
	<input type=submit value=Login>
	\end{verbatim}
\end{exampleblock}
\begin{exampleblock}{Enviado en la request}
	\begin{verbatim}
username=submittedUser&password=submittedPassword
	\end{verbatim}
	
\end{exampleblock}
\end{frame}

\begin{frame}[fragile]
	\frametitle{Inyección SQL: ejemplo trivial 2/2}
	\begin{exampleblock}{Posible SQL en la aplicación}
		\begin{verbatim}
		select * from Users where (username = 'submittedUser'
		and password = 'submittedPassword');
		\end{verbatim}
	\end{exampleblock}
	\begin{exampleblock}{Envío del atacante}
	\begin{verbatim}
	username=admin%27%29+--+&password=+
	\end{verbatim}
\end{exampleblock}
\begin{exampleblock}{Consulta resultante}
	\begin{verbatim}
	select * from Users where (username = 'admin') -- 
	and password = ' ');
	\end{verbatim}
\end{exampleblock}
\end{frame}

\begin{frame}
	\frametitle{Inyección SQL}
\href{https://www.hacksplaining.com/exercises/sql-injection\#}{Simulación de inyección SQL}\\~\\

\textbf{¿Cómo evitar este tipo de ataques?}
\begin{itemize}
	\item Validando la entrada del usuario.
	\item No utilizando sentencias SQL construidas dinámicamente.
	\item No utilizando cuentas con privilegios de administrador.
	\item No proporcionando más información de la estrictamente necesaria.
\end{itemize}

En el caso presentado, escapando los caracteres especiales en los formularios. Ejemplo: " debería transformarse en \textbackslash".


\end{frame}

\begin{frame}[fragile]
	\frametitle{Inyección SQL}
\begin{exampleblock}{Ejemplo en Java con JDBC}
	\begin{verbatim}
	Connection con = (acquire Connection) 
	PreparedStatement query = con.prepareStatement(
	"SELECT * FROM Usuarios WHERE user=? AND pass=?"); 
	query.setString(1, user); 
	query.setString(2, password); 
	ResultSet rset = query.executeQuery();
	\end{verbatim}
\end{exampleblock}

Utilizando \textit{prepared statements}, la entrada del usuario se trata como el contenido de un parámetro y no como parte de la propia sentencia SQL. En el caso de \textit{Bobby Tables}, con el ejemplo anterior se insertaría el texto \textit{''Robert'); DROP TABLE students; --``} en la columna del nombre del alumno.
\end{frame}

\begin{frame}[fragile]
	\frametitle{Ejercicio 1.2}
	Dado el siguiente código para un entorno Python/MySQL:
	\begin{exampleblock}{Ejecución de SQL desde Python}
		\begin{verbatim}
		cmd = "update people set name='{0}' 
		       where id='{1}'".format(name, id)
		cursor.execute(cmd)
		\end{verbatim}
	\end{exampleblock}
Indique si está afectado por la vulnerabilidad de inyección SQL y, de ser así, proponga una alternativa segura.
\begin{alertblock}{Ayuda}
	\href{https://dev.mysql.com/doc/connector-python/en/connector-python-api-mysqlcursor-execute.html}{Documentación sobre la clase MySQLCursor}
	
	\href{https://docs.python.org/3/library/stdtypes.html#str.format}{Documentación sobre el método format}
\end{alertblock}
\end{frame}

\begin{frame}
	\frametitle{Exploits en bases de datos vulnerables}
	La mayor parte de fallos explotables de seguridad en bases de datos pueden clasificarse en las siguientes categorías:  \\~\\
	
	\begin{itemize}
		\item Fallos de autenticación en protocolos de red.
		\item Fallos en los propios protocolos de autenticación.
		\item Ejecución arbitraria de código en elementos SQL.
		\item Escalado de privilegios locales.
	
	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{Exploits: fallos de autenticación en protocolos de red}
	Uno de los problemas más famosos en esta categoría es el gusano \href{https://es.wikipedia.org/wiki/SQL_Slammer}{\textit{``Slammer''}} (75.000 víctimas en diez minutos), para SQL Server. El servicio de resolución de SQL Server opera en UDP 1434, exponiendo una serie de funciones; dos de ellas eran vulnerables a ataques de buffer overflow. No era necesaria autenticación para explotar estas vulnerabilidades. \\~\\
	Las mejores formas de protegerse de este tipo de ataques son:
	\begin{itemize}
			\item Parchear los SGBD al día.
			\item Asegurarse de que sólo pueden conectarse a los SGBD hosts de confianza.
			\item Implementar algún tipo de IPS/IDS.
	\end{itemize}
\begin{block}{Fallos autenticados}
	Hay bastante menos bugs en esta categoría. La mejor protección contra fallos autenticados en protocolos de red es disponer de una política de contraseñas robusta.
\end{block}
\end{frame}
\begin{frame}
	\frametitle{Exploits: fallos en los protocolos de autenticación}
Históricamente, muchos SGBD utilizaban protocolos de autenticación en texto plano (o con algún tipo de encriptación débil). Por ejemplo, la base matemática del algoritmo de autenticación de \textit{MySQL $<$  4.1} fue \href{https://dev.mysql.com/doc/internals/en/old-password-authentication.html}{puesta en cuestión} por la capacidad de un atacante de determinar el \textit{hash} de una contraseña simplemente observando varias autenticaciones.\\~\\
Como medidas para evitar este tipo de ataques, se tienen las siguientes:
	\begin{itemize}
	\item Parchear los SGBD al día.
	\item Deshabilitar cualquier posible sistema de autenticación en texto plano.
\end{itemize}
\end{frame}
\begin{frame}
	\frametitle{Exploits: ejecución arbitraria de código en elementos SQL}
Son ataques de tipo \textit{buffer overflow} aplicados a elementos de la gramática de SQL que no están sujetos a los controles de acceso tradicionales (GRANT/REVOKE). Este tipo de bugs suelen ser explotados a través de problemas de inyección SQL.
\begin{exampleblock}{Ejecución arbitraria en Oracle}
Oracle presentó un bug que permitía a un atacante ejecutar código arbitrario a través de las funciones NYMTOYMINTERVAL, NUMTODSINTERVAL y FROM\_TZ o el parámetro de sesión TIME\_ZONE.
\end{exampleblock}
La mejor defensa contra este tipo de ataques es parchear los SGBD al día.
\end{frame}
\begin{frame}
		\frametitle{Inciso: ¿qué es un buffer overflow?}
Una situación donde un programa en ejecución intenta escribir datos en posiciones fuera del buffer de memoria asignado para ello, en las que no debería escribir.
	\begin{columns}[t] % The "c" option specifies centered vertical alignment while the "t" option is used for top vertical alignment
	\column{.45\textwidth} % Left column and width
		\begin{exampleblock}{Buffer overflow}
		Introducción de un nombre de usuario de 10 caracteres cuando el tamaño de buffer es de 8. Si no se valida la entrada, se produce un desbordamiento.
	\end{exampleblock}
	
	\column{.5\textwidth} % Right column and width
	\begin{figure}
		\includegraphics[width=0.9\linewidth]{buffer-overflow-example}
		\caption{Buffer overflow. \href{https://www.hackingtutorials.org/exploit-tutorials/buffer-overflow-explained-basics/}{Fuente}}
	\end{figure}
	
\end{columns}
\vfill

Un atacante puede llegar a escribir código malicioso en esas posiciones de memoria del buffer desbordado y conseguir escalado de privilegios si el programa se ejecuta con privilegios de sistema.

\end{frame}
\begin{frame}
	\frametitle{Exploits: Escalado de privilegios locales.}
Esta categoría se compone de bugs que permiten algún tipo de escalado de privilegios a nivel de sistema operativo.
	\begin{exampleblock}{Escalado de privilegios locales}
		\begin{itemize}
		\item Oracle \textit{``extproc''}.
		\item Procedimientos almacenados extendidos de SQL Server y Sybase.
	\end{itemize}
	\end{exampleblock}
	La mejor defensa contra este tipo de ataques es \textbf{ejecutar la base de datos como un usuario con pocos privilegios}, o en una parte segregada del sistema de archivos en la cual solo la base de datos pueda realizar operaciones de lectura/escritura.
\end{frame}
%------------------------------------------------
\begin{frame}
	\frametitle{Resumen}
		\begin{itemize}
		\item Si no se detectan más vulnerabilidades, es porque no se buscan.
		\item La normativa vigente obliga a aplicar medidas de seguridad también a las BBDD.
		\item La inyección SQL es el ataque ``estrella''.
		\item No existe una base de datos ``más segura''.
		\item La mejor prevención: mantener los sistemas actualizados y parcheados y aplicar seguridad por defecto.
		
	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{Ejercicio 1.3}
	Una unidad de una organización pública cuyo negocio fundamental es el tratamiento de datos debe poner en marcha un SGBD en el que se almacenarán datos sobre solicitantes de subvenciones. Un problema en su disponibilidad reduciría significativamente la capacidad de la organización para atender la recogida de datos de los solicitantes, aunque podrían seguir desempeñando su trabajo (por ejemplo, tomando nota de los datos a mano.) \\~\\
	Seleccione \textbf{motivadamente} \href{https://www.ccn-cert.cni.es/publico/ens/ens/index.html\#!1071}{las medidas del Esquema Nacional de Seguridad} \textbf{directamente relacionadas con SGBDs} que habría que aplicar al SGBD.\\~\\
	Criterios de evaluación: identificación correcta de medidas, justificaciones claras y coherentes, capacidad de síntesis.
\end{frame}
%------------------------------------------------

\begin{frame}
\frametitle{Referencias}
\footnotesize{
\begin{thebibliography}{99} % Beamer does not support BibTeX so references must be inserted manually as below
\bibitem[Litchfield, 2005]{p1} David Litchfield (2005)
\newblock The Database Hacker's Handbook: Defending Database Servers

\bibitem[Kaspersky, 2017]{p2} Kaspersky Lab (2017)
\newblock IT Security Risks Survey 2017
\end{thebibliography}
}
\end{frame}

%------------------------------------------------


%----------------------------------------------------------------------------------------

\end{document}