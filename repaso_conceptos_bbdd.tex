%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Beamer Presentation
% LaTeX Template
% Version 1.0 (10/11/12)
%
% This template has been downloaded from:
% http://www.LaTeXTemplates.com
%
% License:
% CC BY-NC-SA 3.0 (http://creativecommons.org/licenses/by-nc-sa/3.0/)
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%----------------------------------------------------------------------------------------
%	PACKAGES AND THEMES
%----------------------------------------------------------------------------------------

\documentclass[10pt, spanish]{beamer}


\mode<presentation> {

% The Beamer class comes with a number of default slide themes
% which change the colors and layouts of slides. Below this is a list
% of all the themes, uncomment each in turn to see what they look like.

%\usetheme{default}
%\usetheme{AnnArbor}
%\usetheme{Antibes}
%\usetheme{Bergen}
%\usetheme{Berkeley}
%\usetheme{Berlin}
%\usetheme{Boadilla}
%\usetheme{CambridgeUS}
%\usetheme{Copenhagen}
%\usetheme{Darmstadt}
%\usetheme{Dresden}
%\usetheme{Frankfurt}
%\usetheme{Goettingen}
%\usetheme{Hannover}
%\usetheme{Ilmenau}
%\usetheme{JuanLesPins}
%\usetheme{Luebeck}
%\usetheme{Madrid}
%\usetheme{Malmoe}
%\usetheme{Marburg}
%\usetheme{Montpellier}
%\usetheme{PaloAlto}
%\usetheme{Pittsburgh}
\usetheme{Rochester}
%\usetheme{Singapore}
%\usetheme{Szeged}
%\usetheme{Warsaw}

% As well as themes, the Beamer class has a number of color themes
% for any slide theme. Uncomment each of these in turn to see how it
% changes the colors of your current slide theme.

%\usecolortheme{albatross}
%\usecolortheme{beaver}
%\usecolortheme{beetle}
%\usecolortheme{crane}
%\usecolortheme{dolphin}
%\usecolortheme{dove}
%\usecolortheme{fly}
%\usecolortheme{lily}
%\usecolortheme{orchid}
%\usecolortheme{rose}
%\usecolortheme{seagull}
%\usecolortheme{seahorse}
%\usecolortheme{whale}
%\usecolortheme{wolverine}

%\setbeamertemplate{footline} % To remove the footer line in all slides uncomment this line
%\setbeamertemplate{footline}[page number] % To replace the footer line in all slides with a simple slide count uncomment this line

%\setbeamertemplate{navigation symbols}{} % To remove the navigation symbols from the bottom of all slides uncomment this line
}

\usepackage{graphicx} % Allows including images
\usepackage{booktabs} % Allows the use of \toprule, \midrule and \bottomrule in tables
\usepackage[latin9]{inputenc}
\usepackage[spanish]{babel}
\usepackage{svg}
\usepackage{caption}
\usepackage{minted}
\captionsetup{font=scriptsize,labelfont=scriptsize}
\setbeamerfont{footnote}{size=\tiny}
\hypersetup{colorlinks=true,linkcolor=blue, linktocpage}
\graphicspath{ {./img/} }
\svgpath{ {./img/} }

%----------------------------------------------------------------------------------------
%	TITLE PAGE
%----------------------------------------------------------------------------------------

\title[Short title]{Certificación y controles de seguridad en Bases de Datos: Sistemas de gestión de bases de datos} % The short title appears at the bottom of every slide, the full title is only on the title page

\author{Miguel Expósito Martín} % Your name
\institute[UNICAN] % Your institution as it will appear on the bottom of every slide, may be shorthand to save space
{
Universidad de Cantabria \\ % Your institution for the title page
\medskip
\textit{miguel.exposito@unican.es} % Your email address
}
\date{26/11/2018} % Date, can be changed to a custom date

\addtobeamertemplate{navigation symbols}{}{%
	\usebeamerfont{footline}%
	\usebeamercolor[fg]{footline}%
	\hspace{1em}%
	\insertframenumber/\inserttotalframenumber
}

\begin{document}

\begin{frame}
\titlepage % Print the title page as the first slide
\end{frame}

\begin{frame}
\frametitle{Visión general} % Table of contents slide, comment this block out to remove it
\tableofcontents % Throughout your presentation, if you choose to use \section{} and \subsection{} commands, these will automatically be printed on this slide as an overview of your presentation
\end{frame}

%----------------------------------------------------------------------------------------
%	PRESENTATION SLIDES
%----------------------------------------------------------------------------------------

%------------------------------------------------
\section{Definición} % Sections can be created in order to organize your presentation into discrete blocks, all sections and subsections are automatically printed in the table of contents as an overview of the talk
%------------------------------------------------


\begin{frame}
\frametitle{Definición}
\begin{quote}
Un sistema de gestión de bases de datos (SGBD) es una colección de datos interrelacionados y un conjunto de programas para acceder a dichos datos. La colección de datos, a la que se conoce normalmente como base de datos, contiene información relevante para una organización. El objetivo primordial de un SGBD es ofrecer un medio conveniente y eficiente para almacenar y recuperar información de la base de datos.\cite{p1}
\end{quote}
\begin{quote}
Un SGBD es un paquete de software utilizado para definir, crear, utilizar y mantener una base de datos. Típicamente consiste de varios módulos software, cada uno con su propia funcionalidad.\cite{p2}
\end{quote}

\begin{block}{Valor de mercado}
	\href{https://blogs.gartner.com/merv-adrian/2016/04/12/dbms-2015-numbers-paint-a-picture-of-slow-but-steady-change/}{Según Gartner}, el valor de mercado total de los SGBD en 2015 era de 35.9 billones de dólares, un 8,7\% más comparado con el año anterior.
\end{block}

\end{frame}

\section{Arquitectura} % Sections can be created in order to organize your presentation into discrete blocks, all sections and subsections are automatically printed in the table of contents as an overview of the talk

\begin{frame}
	\frametitle{Arquitectura}
\begin{figure}
	\includegraphics[width=0.85\linewidth]{arch_dbms}
	\caption{Arquitectura de SGBDs.\footnote{Fuente: \cite{p2}}}
\end{figure}
\end{frame}

\begin{frame}
	\frametitle{Arquitectura: gestor de conexiones y seguridad}
	\begin{itemize}
		\item Proporciona facilidades para iniciar una conexión (remota) a una base de datos.
		\item Verifica credenciales de inicio de sesión (usuario/contraseña) y devuelve un manejador de conexión.
		\item Verifica si un usuario tiene los privilegios suficientes para ejecutar las acciones requeridas.
	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{Arquitectura: compilador de DDL}
	\begin{itemize}
		\item Compila las definiciones de datos especificadas en DDL(\textit{Data Definition Language})
		\item Parsea las definiciones de DDL, comprueba su corrección sintáctica y lo traduce a un formato interno.
		\item Una vez compilado con éxito, se registran las definiciones de datos en el catálogo.
	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{Arquitectura: procesador de consultas}
	
		Una de las partes más importantes de un SGBD, asiste en la ejecución de consultas a la base de datos tales como recuperación, inserción, actualización o borrado de información. Generalmente consta de los siguientes componentes:
		\begin{itemize}
			\item Compilador DML (\textit{Data Manipulation Language}): compila las sentencias de manipulación de datos. SQL es un DML declarativo.
			\item Procesador de consultas: parsea la consulta a un formato de representación interno. Puede reescribir la consulta para optimizarla independientemente del estado de la BD, utilizando un conjunto de reglas predefinidas específicas del SGBD.
			\item Optimizador de consultas: optimiza la consulta en función del estado de la BD, evaluando los distintos planes de ejecución. Estas estimaciones se llevan a cabo utilizando el catálogo y procedimientos de inferencia estadística.
			\item Ejecutor de consultas: se encarga de la ejecución de la consulta devuelta por el optimizador recuperando los datos solicitados desde el gestor de almacenamiento.
	\end{itemize}
\end{frame}
\begin{frame}
	\frametitle{Arquitectura: procesador de consultas}
	
	\begin{itemize}
		\item Gestor de almacenamiento: gobierna el acceso físico a los archivos y supervisa el correcto almacenamiento de datos. Consta de:
		\begin{itemize}
		\item Gestor de transacciones: supervisa la ejecución de transacciones, creando una planificación con operaciones de lectura y escritura mejorando la eficiencia y rendimiento globales y garantizando atomicidad, consistencia, aislamiento y durabilidad (ACID).
		\item Gestor de buffer: gestiona la memoria de buffer del SGBD. Es responsable de su cacheo y monitorización.
		\item Gestor de bloqueos: juega un importante papel en el control de concurrencia, asegurando la integridad de los datos en todo momento. Evita conflictos entre transacciones previniendo actualizaciones simultáneas sobre un mismo elemento de datos.
		\item Gestor de recuperación: recoge todas las operaciones de base de datos en un fichero de histórico, pudiendo ser utilizado para deshacer acciones o transacciones abortadas, así como para recuperación de caídas.
\end{itemize}
	\end{itemize}
\end{frame}
\begin{frame}
	\frametitle{Arquitectura: utilidades e interfaces}
	
	\begin{itemize}
		\item Un SGBD cuenta con diversas utilidades:
			\begin{itemize}
			\item Utilidad de carga: soporta la importación de datos en la BD desde diferentes fuentes.
			\item Utilidad de reorganización: reorganiza automáticamente la BD para mejorar su rendimiento.
			\item Utilidades de monitorización: tiempos de respuesta, espacio de almacenamiento, etc.
			\item Utilidades de gestión de usuarios: usuarios, roles y privilegios.
			\item Utilidades de copia de seguridad y recuperación.
		\end{itemize}
	\item Un SGBD necesita interactuar con diversos actores: diseñadores, administradores, aplicaciones, usuarios finales... Para facilitar dicha comunicación, se proporcionan varios interfaces de usuario (web, línea de comandos, GUI de escritorio, etc.). Ejemplo: \href{https://www.mysql.com/products/workbench/}{MySQL Workbench}.
	\end{itemize}
\end{frame}
\section{Categorización} % Sections can be created in order to organize your presentation into discrete blocks, all sections and subsections are automatically printed in the table of contents as an overview of the talk
\begin{frame}
	\frametitle{Categorización}
	
	\begin{itemize}
		\item Basada en el modelo de datos
	\begin{itemize}
	\item 	Jerárquica: modelo basado en árbol. Procedural y orientada a registro. No tiene procesador de consultas. Ejemplo: el registro de \textit{Windows}.
	\item 		De red: modelo basado en red, más flexible que el jerárquico.  Procedural y orientada a registro, tampoco tiene procesador de consultas. CODASYL es uno de los tipos de BD jerárquica más populares.
	\item 		Relacional: utiliza el modelo relacional, el más usado en la industria.SQL se utiliza tanto para DML como para DDL. Es declarativo y orientado a conjuntos. Sí tiene procesador de consultas y presenta separación entre modelo lógico y de datos internos. Ejemplos: \textit{Oracle, MySQL, SQL Server...}
\end{itemize}
\end{itemize}
\end{frame}
\begin{frame}
	\frametitle{Categorización}
	\begin{itemize}
		\item Basada en el modelo de datos
	\begin{itemize}
	\item 		Orientada a objetos: basada en el modelo del mismo nombre. Ejemplo: \textit{db4o}. No son muy populares en la industria debido a su complejidad.
	\item 		Relacional extendida: utiliza el modelo relacional extendido con conceptos de orientación a objetos. La mayor parte de las BBDD relacionales incorporan este tipo de extensiones.
	\item 		XML: utiliza el modelo XML para almacenar datos. Las BBDD relacionales también incorporan extensiones para XML. Ejemplo: \textit{eXist}.
	\item 		NoSQL (documentos, grafos): almacenes clave-valor, de documentos (JSON), de grafos (RDF)... Ejemplos: \textit{MongoDB, Neo4j}.
\end{itemize}
		\item Basada en el grado de acceso simultáneo
\begin{itemize}
	\item 	Monousuario: solo un usuario a la vez. Ej: \textit{MS Access}.
	\item 	Multiusuario: múltiples usuarios interactuando simultáneamente. 
\end{itemize}
\end{itemize}
\end{frame}
\begin{frame}
	\frametitle{Categorización}
	\begin{itemize}
		\item Basada en la arquitectura
	\begin{itemize}
	\item 	Centralizada: mainframes que procesan todas las consultas en un único host.
	\item 		Cliente-servidor: clientes activos solicitan servicios a servidores pasivos.
	\item 		N-capas: GUI + servidor de aplicaciones + BD.
	\item 		En la nube: alojada por terceros, pueden distribuir los datos entre múltiples máquinas. Ej: \textit{Cassandra}.
	\item 		Federada: proporciona una interfaz uniforme a múltiples fuentes de datos subyacentes.
	\item 		En memoria: almacena los datos en memoria. Se utilizan para propósitos de tiempo real.
\end{itemize}
	\end{itemize}
\end{frame}
\begin{frame}
	\frametitle{Categorización}
		\begin{itemize}
		\item Basada en el tipo de uso
	\begin{itemize}
	\item 	Transaccional (OLTP): enfocada en gestión operacional o transaccional (ej: TPV). Deben tener buen soporte para grandes volúmenes de consultas pequeñas.
	\item 		Analítica (OLAP): enfocada en utilizar datos operativos con enfoques tácticos o estratégicos. En este paragidma, un número limitado de usuarios lanza consultas complejas para analizar altos volúmenes de datos.
	\item 		Multimedia: permite almacenar datos en forma de texto, imágenes, audio, vídeo...Proporcionan motores de consulta basados en el contenido.
	\item 		Espacial: soporta el almacenamiento y consulta de datos espaciales. Es la base de los GIS. Ej: PostgreSQL.
	\item 		Móvil: se ejecuta sobre \textit{smartphones}. Presenta una baja huella de memoria, ideal para potencia de cálculo limitada. Ejemplos: \textit{SQLite, Oracle Lite, SQL Server Compact,} etc.
\end{itemize}
	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{Ejercicio 2.1: seleccione la respuesta correcta}
	\begin{enumerate}
	\item ¿Cuál de los siguientes componentes \textbf{no es parte} del gestor de almacenamiento en una arquitectura de SGBD?
	
\begin{enumerate}[a.]
	\item Gestor de conexiones
	\item Gestor de transacciones
	\item Gestor de buffer
	\item Gestor de recuperación
\end{enumerate}
\vfill
\item	CODASYL es un ejemplo de...
\begin{enumerate}[a.]
	\item SGBD jerárquico
	\item SGBD en red
	\item SGBD relacional
	\item SGBD orientado a objetos
\end{enumerate}
\end{enumerate}
\end{frame}

\begin{frame}
	\frametitle{Ejercicio 2.1: seleccione la respuesta correcta}
	\begin{enumerate}
		\setcounter{enumi}{2}
		\item ¿Cuál de los siguientes tipos de SGBD \textbf{no pertenece} a una clasificación basada en modelo de datos?
		
		\begin{enumerate}[a.]
			\item SGBD jerárquico
			\item SGBD en red
			\item SGBD en la nube
			\item SGBD objeto-relacional
		\end{enumerate}
		\vfill
		\item Si necesita utilizar una arquitectura de SGBD que permita el acceso a múltiples fuentes de datos y proporcione una interfaz uniforme que oculte los detalles de bajo nivel, el SGBD más apropiado sería...
		\begin{enumerate}[a.]
			\item SGBD de n-capas
			\item SGBD en la nube
			\item SGBD cliente-servidor
			\item SGBD federado
		\end{enumerate}
	\end{enumerate}
\end{frame}

\begin{frame}
	\frametitle{Ejercicio 2.1: seleccione la respuesta correcta}
	\begin{enumerate}
			\setcounter{enumi}{4}
		\item ¿Qué afirmación \textbf{no es correcta}?
		
		\begin{enumerate}[a.]
			\item Un SGBD relacional presenta una separación completa entre el modelo de datos interno y el lógico. 
			\item Una arquitectura de SGBD en la nube es aconsejable para empresas pequeñas.
			\item El procesador/re-escritor de consultas optimiza una consulta basándose en el estado actual de la BD.
			\item Un SGBD en memoria almacena todos los datos en la memoria interna en lugar de utilizar almacenamiento externo más lento, como el basado en disco.
		\end{enumerate}
	
	\end{enumerate}
\end{frame}

\begin{frame}
	\frametitle{Ejercicio 2.1: seleccione la respuesta correcta}
		\begin{enumerate}
	\setcounter{enumi}{5}
		\item ¿Qué afirmación \textbf{es correcta}?
	\begin{enumerate}[a.]
		\item El compilador de DDL procesa sentencias DDL, comprueba su corrección semántica, las traslada a un formato interno y registra las definiciones de datos en el catálogo.
		\item El procesador/re-escritor de consultas optimiza las consultas basándose en el estado actual de la base de datos.
		\item Un SGBD OLTP se utiliza principalmente para toma de decisiones estratégicas y tácticas.
		\item Un SGBD con capacidades XML permite almacenar datos en este formato; sin embargo, no permite lanzarle consultas.
	\end{enumerate}
	\end{enumerate}
\end{frame}

\section{Seguridad en SGBDs}

\begin{frame}[fragile]
	\frametitle{Seguridad en SGBDs}
	En general, todos los SGBDs disponen de mecanismos más o menos sofisticados para garantizar la seguridad en sus distintas dimensiones. Algunos de estos mecanismos son:
	
	\begin{itemize}
	\item Configuración segura a nivel de red y de sistema operativo.
	\item Conexiones seguras cliente-servidor.
	\item Gestión de usuarios y roles.
	\item Encriptación de datos.
	\item Anonimización o enmascarado de datos.
	\item Funcionalidades de auditoría.
	\end{itemize}

En las siguientes secciones se revisarán estos mecanismos a través de un caso de uso: MariaDB.
	
\end{frame}

\section{Caso de uso: MySQL}
\subsection{Instalación}

\begin{frame}
	\frametitle{Ejercicio 2.2: instalación de un SGBD}
	Para poder realizar este y otros ejercicios, será necesario disponer de una instancia de base de datos de pruebas. En este caso, se instalará MariaDB. MariaDB es un clon de MySQL, un SGBD opensource muy popular en la industria que puede descargarse de forma gratuita desde su web. \\~\\
	
	Para este ejercicio, se utilizará \href{https://www.vagrantup.com/downloads.html}{Vagrant} para desplegar una VM con MariaDB. Se trata de una herramienta que permite la creación y configuración de entornos de desarrollo ligeros, reproducibles y portables.
	
	\begin{block}{¿Qué es Vagrant en realidad?}
	No es más que un wrapper sobre Virtualbox o VMware. Un archivo de configuración define la máquina, el software a instalar y la forma de acceso.
	
	\textbf{ADIOS A LA FRASE ``EN MI MÁQUINA FUNCIONA''}
	\end{block}
\end{frame}

\begin{frame}[fragile]
	\frametitle{Ejercicio 2.2: instalación de un SGBD}
	Como paso previo, será necesario instalar Virtualbox. Para ello:
	\begin{enumerate}
		\item \href{https://www.virtualbox.org/wiki/Downloads}{Descargar} el archivo de instalación para la plataforma adecuada.
		\item Seguir el proceso de instalación.
		
	\end{enumerate}
	Para instalar Vagrant:
\begin{enumerate}
	\item \href{https://www.vagrantup.com/downloads.html}{Descargar} el archivo de instalación para la plataforma adecuada
	\item Seguir el proceso de instalación.
	\item Una vez finalizado, crear un directorio de trabajo (p.ej., \textit{seguridad})
	\item En dicho directorio, crear un fichero \textit{Vagrantfile} con el siguiente contenido:
	
\end{enumerate}
\begin{exampleblock}{Fichero Vagrantfile}
	\begin{verbatim}
	Vagrant.configure("2") do |config|
	config.vm.box = "ubuntu/trusty64"
	end
	\end{verbatim}
	
\end{exampleblock}

	
\end{frame}

\begin{frame}[fragile]
	\frametitle{Ejercicio 2.2: instalación de un SGBD}
	Para iniciar sesión en la VM:
	
	\begin{itemize}
		\item Arrancar la máquina de vagrant ejecutando desde la shell en el directorio donde reside el Vagrantfile:
			\begin{exampleblock}{Arranque de la VM con Ubuntu}
			\begin{verbatim}
		vagrant up
		vagrant ssh
			\end{verbatim}
		\end{exampleblock}
	\end{itemize}
\begin{alertblock}{Importante: sobre Vagrant}
\begin{itemize}
	\item 	La contraseña de superusuario es \textbf{vagrant}
	\item 	El directorio donde se ubica el \textit{Vagrantfile} se comparte en la VM invitada (\textit{guest}) en \textbf{/vagrant/}
\end{itemize}
\end{alertblock}

	
\end{frame}

\begin{frame}[fragile]
	\frametitle{Ejercicio 2.2: instalación de un SGBD}
	Para instalar MariaDB:
		\begin{exampleblock}{Instalación de MariaDB en Ubuntu}
			\begin{verbatim}
			sudo apt-get install software-properties-common
			sudo apt-key adv --recv-keys --keyserver  \
			hkp://keyserver.ubuntu.com:80 0xcbcb082a1bb943db
			sudo add-apt-repository 'deb  \
			http://tedeco.fi.upm.es/mirror/mariadb/repo/10.3/ubuntu \
			trusty main'
			sudo apt-get update
			sudo apt-get install mariadb-server
			\end{verbatim}
		\end{exampleblock}
	
\end{frame}


\begin{frame}[fragile]
	\frametitle{Ejercicio 2.2: instalación de un SGBD}
	Durante el proceso de instalación, se solicitará una contraseña para el usuario root.
	
	\begin{itemize}
		\item Arrancar la máquina de vagrant ejecutando desde la shell en el directorio donde reside el Vagrantfile:
		\begin{exampleblock}{Arranque de la VM con Ubuntu}
			\begin{verbatim}
			vagrant up
			vagrant ssh
			sudo apt-get update # una vez iniciada sesión
			sudo apt-get install mariadb-server
			\end{verbatim}
		\end{exampleblock}
	\end{itemize}
	\begin{alertblock}{Importante: sobre Vagrant}
		\begin{itemize}
			\item 	La contraseña de superusuario es \textbf{vagrant}
			\item 	El directorio donde se ubica el \textit{Vagrantfile} se comparte en la VM invitada (\textit{guest}) en \textbf{/vagrant/}
		\end{itemize}
	\end{alertblock}
\end{frame}


\begin{frame}[fragile]
	\frametitle{Ejercicio 2.2: instalación de un SGBD}
	Para comprobar que la instalación es correcta:
	\begin{exampleblock}{Arranque de la VM con Ubuntu}
		\begin{verbatim}
		# verificar que la BD escucha en el puerto correspondiente
		netstat -anp | grep 3306 
		# iniciar sesión con el usuario root
		mysql -u root -p
		# mostrar los schemas existentes
		show databases
		\end{verbatim}
	\end{exampleblock}
	
\end{frame}

\begin{frame}[fragile]
	\frametitle{¿qué contraseña habéis puesto?}
	\begin{alertenv}
	root, prueba, admin, blank, mysql...
\end{alertenv}
\end{frame}

\begin{frame}[fragile]
	\frametitle{mejor algo así...}

\begin{figure}
	\includegraphics[width=0.7\linewidth]{password_strength}
	\caption{Password strength.\footnote{Fuente: \href{xkcd}{https://xkcd.com/936/}}}
\end{figure}

\end{frame}

\subsection{Seguridad}


\begin{frame}[fragile]
	\frametitle{Seguridad en MariaDB: contraseñas}
	MariaDB 10.1 introduce una API de validación de contraseñas (ver \href{https://mariadb.com/kb/en/library/password-validation/}{Password Validation Plugin API}). Esto permite crear validadores de contraseñas personalizados así como implementar autenticación de dos factores (por ejemplo, con \textit{Google Authenticator}).\\~\\
	Esta versión también ofrece extensiones listas para usar, como \mintinline{bash}{simple_password_check}, para el establecimiento de políticas de contraseñas, o \href{https://github.com/cracklib/cracklib}{cracklib{\_}password{\_}check}, que comprueba la robustez de la contraseña según la biblioteca \textit{CrackLib}.
	
\end{frame}

\begin{frame}[fragile]
	\frametitle{Seguridad en MariaDB: autenticación}
	Desde su versión 5.2, MariaDB cuenta con la extensión de autenticación \href{https://mariadb.com/kb/en/library/authentication-plugin-pam/}{PAM}, que permite a los DBAs establecer un entorno de base de datos en el que los usuarios puedan utilizar las mismas contraseñas de los inicios de sesión a través de shell y otros servicios.\\~\\
	Además, la biblioteca compartida \href{https://linux.die.net/man/5/pam_ldap}{pam{\_}ldap} permite que los usuarios se autentiquen contra un servidor LDAP.\\~\\
	Finalmente, para la versión 10.2 de la BD estaba planificada la puesta en producción de una extensión con soporte para \href{https://mariadb.atlassian.net/browse/MDEV-4691}{Kerberos}.
	
\end{frame}

\begin{frame}[fragile]
	\frametitle{Seguridad en MariaDB: roles y encriptación}
	La versión 10.0 ya introdujo los \textbf{roles de usuario}, funcionalidad que ha sido mejorada en la versión 10.1. Los DBAs pueden empaquetar un conjunto de privilegios y asociarlos a un rol, pudiendo conceder un rol y sus privilegios asociados a uno o varios usuarios. Asimismo, se puede asignar un rol por defecto a cada usuario creado.\\~\\
	Por último, el \textbf{soporte para encriptación} es quizá el aspecto relacionado con la seguridad de la información más interesante de la versión 10.1. Permite encriptar \textit{tablespaces}, tablas y logs. 
	
\end{frame}

\subsection{Securización}
\begin{frame}
	\frametitle{Securización de MariaDB: líneas generales}
\begin{itemize}
\item Solo el usuario \textit{root} debe tener acceso a la tabla user.
\item Nunca conceder privilegios innecesarios o a todos los hosts.
\item Nunca almacenar contraseñas en texto plano (almacenar un hash SHA2).
\item Securizar la red con un cortafuegos. Bloquear el puerto 3306 excepto a hosts autorizados.
\item Nunca enviar datos sin encriptar a través de la red (usar SSH, TLS).
\item Requerir que todas las cuentas de usuario tengan contraseña.
\item Garantizar que la única cuenta de usuario de Linux con permisos de lectura o escritura en los directorios de la base de datos es la utilizada para ejecutar \textit{mysqld}.
\item Nunca ejecutar el proceso servidor como usuario \textit{root}.
\item Eliminar usuarios anónimos y \textit{database test}.
\item No permitir que \textit{root} acceda remotamente.
\end{itemize}
	
\end{frame}

\begin{frame}[fragile]
	\frametitle{Securización de MariaDB: opciones mysqld}
	\begin{itemize}
		\item \mintinline{bash}{--local-infile=0}: hará que el comando \mintinline{sql}{LOAD DATA LOCAL} falle. Este comando carga un archivo de texto en una tabla con gran rapidez; LOCAL hace que el archivo se lea en el cliente.
		\item \mintinline{bash}{--safe-show-database}: sustituido en MariaDB 5.5 por el privilegio \mintinline{sql}{SHOW DATABASES}. Permite al usuario listar las bases de datos existentes.
		\item \mintinline{bash}{--safe-user-create}: impide la creación de nuevos usuarios por un usuario que no tiene privilegios de escritura en la tabla \mintinline{sql}{mysql.user}
		\item \mintinline{bash}{--secure-auth}: impide la autenticación con cuentas que tengan contraseñas en formato anterior a MySQL 4.1.
		\item \mintinline{bash}{--skip-name-resolve}: si vale 1, solo se utilizarán IPs para las conexiones (no DNS).
		\item \mintinline{bash}{--skip-symbolic-links}: usando enlaces simbólicos, mysqld podría usarse para eliminar o renombrar un archivo fuera del directorio de datos. Versiones anteriores a 5.0.67 contienen una vulnerabilidad relacionada (CVE-2008-4097).
	\end{itemize}
	
\end{frame}

\begin{frame}[fragile]
	\frametitle{Securización de MariaDB: otras recomendaciones}
	\begin{itemize}
		\item No usar \mintinline{bash}{--skip-grant-tables}: este flag permite conectarse a cualquiera sin usuario, contraseña y privilegios. Deshabilita la gestión de cuentas de usuario.
		\item En Windows, no usar \mintinline{bash}{--enabled-named-pipe}. Usar TCP.
		\item No conceder los privilegios \mintinline{sql}{PROCESS, FILE, SUPER} a usuarios no administradores.
		\item No ejecutar MariaDB en el mismo servidor que un backend de una aplicación. Muchos servidores web tienen vulnerabilidades conocidas que permitirían a un atacante acceder a la base de datos.
		\item Deshabilitar el control total de la base de datos a usuarios locales y los permisos por defecto para usuarios remotos.
		\item No utilizar versiones previas a 4.1.X. (En general, usar siempre las últimas versiones).
		\item No permitir a los desarrolladores el acceso a entornos de producción.
		\item Activar las funciones de auditoría.
	
	\end{itemize}
	
\end{frame}

\begin{frame}[fragile]
	\frametitle{Ejercicio 2.3: securizar MariaDB}
	\mintinline{bash}{mysql_secure_installation} es un shell script disponible para sistemas Unix que permite mejorar la seguridad de una instalación de MariaDB de las siguientes formas:
	\begin{itemize}
		\item Asignando una contraseña a las cuentas de root.
		\item Eliminando cuentas de root con acceso desde fuera del host local.
		\item Eliminando cuentas de usuarios anónimos
		\item Eliminando la base de datos de test, que puede ser accedida por defecto por usuarios anónimos
	\end{itemize}

Ejecute el script y responda a las preguntas interactivamente. Por otra parte, compruebe qué usuario del sistema operativo está ejecutando el proceso \mintinline{bash}{mysqld}. ¿Lo considera seguro?
	
\end{frame}

\subsection{Conexiones seguras}

\begin{frame}[fragile]
	\frametitle{Conexiones seguras en MariaDB}
Por defecto, MariaDB transmite los datos en claro entre el servidor y los clientes. Esto puede ser aceptable si el servidor y el cliente se ejecutan en la misma máquina, pero no lo es cuando no se da esta circunstancia.\\~\\
Para mitigar este problema, MariaDB permite encriptar los datos entre el cliente y el servidor usando TLS (Transpor Layer Security).

\begin{exampleblock}{Comprobar soporte para TLS}
	\begin{verbatim}
	SHOW VARIABLES LIKE 'have_ssl';
	\end{verbatim}
\end{exampleblock}

Si el valor de \mintinline{bash}{have_ssl} es DISABLED implica que el SGBD tiene soporte para TLS pero este está desactivado. Antes de activarlo, será necesario generar los certificados de servidor y cliente.
	
\end{frame}

\begin{frame}[fragile]
	\frametitle{Ejercicio 2.4: creación de certificados SSL}
	
	\begin{exampleblock}{Paso previo: directorio de trabajo}
		\begin{verbatim}
		$ su
		$ cd /etc/mysql
		$ mkdir ssl
		$ cd ssl
		
		\end{verbatim}
	\end{exampleblock}
	\begin{exampleblock}{Creación de certificado de CA}
	\begin{verbatim}
	# openssl genrsa 2048 > ca-key.pem
	# sudo openssl req -new -x509 -nodes -days 
	365000 -key ca-key.pem -out ca-cert.pem
	\end{verbatim}
\end{exampleblock}
	
\end{frame}

\begin{frame}[fragile]
	\frametitle{Ejercicio 2.4: creación de certificados SSL}
	
	\begin{exampleblock}{Creación de certificado de servidor}
		\begin{verbatim}
		# openssl req -newkey rsa:2048 -days 365000 -nodes
		 -keyout server-key.pem -out server-req.pem
		# openssl rsa -in server-key.pem -out server-key.pem
		# openssl x509 -req -in server-req.pem -days 365000
		 -CA ca-cert.pem -CAkey ca-key.pem -set_serial 01 -out
		  server-cert.pem
		\end{verbatim}
	\end{exampleblock}
	
\end{frame}

\begin{frame}[fragile]
	\frametitle{Ejercicio 2.4: creación de certificados SSL}
	
	\begin{exampleblock}{Creación de certificado de cliente}
		\begin{verbatim}
		# openssl req -newkey rsa:2048 -days 365000 -nodes
		 -keyout client-key.pem -out client-req.pem
		# openssl rsa -in client-key.pem -out client-key.pem
		# openssl x509 -req -in client-req.pem -days 365000
		 -CA ca-cert.pem -CAkey ca-key.pem -set_serial 01 -out
		  client-cert.pem
		\end{verbatim}
	\end{exampleblock}
	\begin{exampleblock}{Verificación de certificados}
	\begin{verbatim}
	# openssl verify -CAfile ca-cert.pem server-cert.pem
	 client-cert.pem
	\end{verbatim}
\end{exampleblock}
	
\end{frame}

\begin{frame}[fragile]
	\frametitle{Ejercicio 2.4: conexiones seguras}
	
	\begin{exampleblock}{Activar SSL en el servidor}
		\begin{verbatim}
		# vi /etc/mysql/mariadb.conf.d/50-server.cnf
		\end{verbatim}
	\end{exampleblock}
	\begin{exampleblock}{Contenido a añadir}
		\begin{verbatim}
		[mysqld]
		ssl
		ssl-ca=/etc/mysql/ssl/ca-cert.pem
		ssl-cert=/etc/mysql/ssl/server-cert.pem
		ssl-key=/etc/mysql/ssl/server-key.pem
		\end{verbatim}
	\end{exampleblock}
\begin{exampleblock}{Reiniciar servidor}
	\begin{verbatim}
	# /etc/init.d/mysql restart
	\end{verbatim}
\end{exampleblock}
	
\end{frame}

\begin{frame}[fragile]
	\frametitle{Ejercicio 2.4: conexiones seguras}
	
	\begin{exampleblock}{Configurar SSL en cliente}
		\begin{verbatim}
		# vi /etc/mysql/mariadb.conf.d/50-mysql-clients.cnf
		\end{verbatim}
	\end{exampleblock}
	\begin{exampleblock}{Contenido a añadir}
		\begin{verbatim}
		[mysql]
		ssl-ca=/etc/mysql/ssl/ca-cert.pem
		ssl-cert=/etc/mysql/ssl/client-cert.pem
		ssl-key=/etc/mysql/ssl/client-key.pem
		\end{verbatim}
	\end{exampleblock}
	Los certificados de CA y cliente así como la clave privada del cliente deben copiarse a todos los clientes desde donde se desee conectar.
	
\end{frame}

\begin{frame}[fragile]
	\frametitle{Ejercicio 2.4: conexiones seguras}
	
	\begin{exampleblock}{Conexión con el cliente}
		\begin{verbatim}
		# mysql -u root -p
		\end{verbatim}
	\end{exampleblock}
	\begin{exampleblock}{Comandos a ejecutar en la BD}
		\begin{verbatim}
		MariaDB [(none)]> SHOW VARIABLES LIKE '%ssl%';
		MariaDB [(none)]> status;
		\end{verbatim}
	\end{exampleblock}
	Comprobar el contenido del parámetro SSL.
	
\end{frame}

\begin{frame}[fragile]
	\frametitle{Ejercicio 2.5: conexión segura desde Python}
	Crear un pequeño script en Python que, usando el paquete \mintinline{python}{MySQLdb}, utilice los certificados de cliente para conectarse a la base de datos y ejecutar el comando \mintinline{sql}{"SHOW STATUS LIKE 'Ssl_cipher'"}, cuyo resultado deberá mostrar por consola.
\end{frame}

\begin{frame}[fragile]
	\frametitle{Data at Rest Encryption}
	También conocida como "Transparent Data Encryption", esta tecnología permite encriptar los datos de las tablas almacenadas en disco. Está soportada en varios motores de almacenamiento (XtraDB, InnoDB, Aria). Entre sus limitaciones:
	
	\begin{itemize}
		\item No se encriptan metadatos ni datos enviados al cliente.
		\item El log de error no se encripta.
		\item El complemento de auditoría no puede generar salida encriptada.
	\end{itemize}

Para utilizar esta funcionalidad, es necesario instalar un complemento que gestione las claves de encriptación (ej: \href{https://mariadb.com/kb/en/encryption-key-management/}{File Key Management Plugin}). \\~\\
El encriptado ocurre al escribir páginas a disco. También es posible encriptar archivos temporales y archivos de log binarios.
\end{frame}
%------------------------------------------------
\begin{frame}
	\frametitle{Resumen}
		
\end{frame}
%------------------------------------------------

\begin{frame}
\frametitle{Referencias}
\footnotesize{
\begin{thebibliography}{99} % Beamer does not support BibTeX so references must be inserted manually as below
\bibitem[Silberschatz, 2010]{p1} Abraham Silberschatz et al. (2010)
\newblock Database System Concepts, 6th edition

\bibitem[Lemahieu, 2018]{p2} Wilfried Lemahieu et al. (2018)
\newblock Principles of Database Management
\end{thebibliography}
}
\end{frame}

%------------------------------------------------


%----------------------------------------------------------------------------------------

\end{document}